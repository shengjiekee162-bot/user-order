<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>æˆ‘çš„è®¢å• - Shopee Clone</title>
<style>
body { font-family: Arial, sans-serif; background:#fafafa; margin:0; padding:0; }
header { background:#f53d2d; color:white; padding:15px 20px; display:flex; justify-content:space-between; align-items:center; }
header h1 { margin:0; }
.orders { padding:20px; }
.order { background:white; margin-bottom:15px; padding:15px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
.order h3 { margin:0 0 10px 0; }
.order table { width:100%; border-collapse: collapse; margin-top:10px; }
.order table th, .order table td { border:1px solid #ddd; padding:8px; text-align:left; }
</style>
</head>
<body>

<header>
  <h1>æˆ‘çš„è®¢å• ğŸ§¾</h1>
  <div><a href="index.html" style="color:white;">è¿”å›é¦–é¡µ</a></div>
</header>

<div class="orders" id="ordersContainer"></div>

<script>
let currentUser = JSON.parse(localStorage.getItem("user"));
if(!currentUser){
  alert("è¯·å…ˆç™»å½•ï¼");
  window.location.href="login.html";
}

// å®‰å…¨ fetch
async function safeFetch(url, options){
  try{
    const res = await fetch(url, options);
    const text = await res.text();
    try { return JSON.parse(text); } 
    catch { alert("è¿”å›é”™è¯¯: "+text); return null; }
  } catch(err){ alert("ç½‘ç»œé”™è¯¯: "+err.message); return null; }
}

// åŠ è½½è®¢å•
async function loadOrders(){
  const data = await safeFetch(`api.php?action=my_orders&user_id=${currentUser.id}`);
  if(!data) return;
  const container = document.getElementById('ordersContainer');
  container.innerHTML = '';
  data.forEach(order=>{
    let itemsHtml = '<table><tr><th>å•†å“</th><th>ä»·æ ¼</th><th>æ•°é‡</th></tr>';
    order.items.forEach(i=>{
      itemsHtml += `<tr><td>${i.name}</td><td>RM ${i.price}</td><td>${i.quantity}</td></tr>`;
    });
    itemsHtml += '</table>';
    container.innerHTML += `
      <div class="order">
        <h3>è®¢å•ID: ${order.order_id} | æ€»ä»·: RM ${order.total_price} | ä¸‹å•æ—¶é—´: ${order.created_at}</h3>
        <p>æ”¶ä»¶äºº: ${order.recipient_name} | åœ°å€: ${order.recipient_address}</p>
        ${itemsHtml}
      </div>`;
  });
}

loadOrders();
</script>

</body>
</html>
