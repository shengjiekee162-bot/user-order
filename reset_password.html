<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>重置密码</title>
<style>
body { font-family: Arial; background: #f7f7f7; display:flex; justify-content:center; align-items:center; height:100vh; }
form { background:white; padding:30px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
input { display:block; width:300px; margin:10px 0; padding:8px; }
button { background:#f53d2d; color:white; border:none; padding:10px; width:100%; cursor:pointer; }
</style>
</head>
<body>

<form id="resetForm">
  <h2>设置新密码</h2>
  <input type="text" id="token" placeholder="重置码" required>
  <input type="password" id="password" placeholder="新密码" required>
  <input type="password" id="password2" placeholder="确认新密码" required>
  <button type="submit">重置密码</button>
  <div id="result" style="margin-top:12px;color:#333;"></div>
  <a href="login.html">返回登录</a>
</form>

<script>
// 从 query string 填充 token （若存在）
const params = new URLSearchParams(window.location.search);
if(params.has('token')){
  document.getElementById('token').value = params.get('token');
}

document.getElementById('resetForm').onsubmit = async function(e){
  e.preventDefault();
  const token = document.getElementById('token').value.trim();
  const pw = document.getElementById('password').value;
  const pw2 = document.getElementById('password2').value;
  if(!token) return alert('请输入重置码');
  if(!pw || pw !== pw2) return alert('两次密码输入不一致或为空');
  const payload = { action: 'reset_password', token, password: pw };
  try{
    const res = await fetch('auth.php', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(payload) });
    const msg = await res.json();
    if(msg.status === 'ok'){
      document.getElementById('result').textContent = '密码重置成功，请使用新密码登录';
    } else {
      document.getElementById('result').textContent = '错误：' + (msg.message || '重置失败');
    }
  } catch(err){
    document.getElementById('result').textContent = '网络错误：' + err.message;
  }
};
</script>

</body>
</html>
