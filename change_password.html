<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>使用旧密码修改 - 更改密码</title>
  <style>
    :root{
      --bg-1: #040612;
      --bg-2: #0b1230;
      --accent-a: #00d4ff;
      --accent-b: #b464ff;
      --muted: #98a3b8;
    }

    html,body{height:100%;}
    body{font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; margin:0; padding:36px 18px; background: radial-gradient(1200px 600px at 10% 10%, #07102a 0%, #040612 25%, #020012 60%), linear-gradient(180deg,var(--bg-1),var(--bg-2)); color:#eaf6ff}

    .card{max-width:520px;margin:36px auto;background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.28));padding:24px;border-radius:12px;box-shadow: 0 12px 40px rgba(3,6,20,0.7), 0 0 40px rgba(124,77,255,0.04) inset;border:1px solid rgba(180,100,255,0.06)}
    h1{font-size:20px;margin:0 0 12px;color:var(--accent-a);text-shadow:0 4px 24px rgba(0,212,255,0.06)}
    label{display:block;margin:10px 0;color:#cfe9ff}
    input{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#eaf6ff;box-shadow:0 6px 18px rgba(2,6,20,0.6)}
    input:focus{outline:none;border-color:var(--accent-a);box-shadow:0 0 14px rgba(0,212,255,0.06)}
    button{padding:10px 14px;border:none;background:linear-gradient(90deg,var(--accent-a),var(--accent-b));color:#031026;border-radius:10px;cursor:pointer;font-weight:600}
    .muted{color:var(--muted);font-size:0.95em}
    .small{padding:8px 10px}
    a{color:var(--muted);text-decoration:none}
    .accent-link{ color: var(--accent-b); font-weight:700 }
  </style>
</head>
<body>
  <div class="card">
    <h1 data-i18n="change.title">使用旧密码修改密码</h1>
    <p class="muted">如果您记得旧密码，可以在此输入旧密码并设置新的密码（无需邮箱验证码）。</p>

    <label>用户名
      <input id="cp_username" type="text" placeholder="您的用户名" data-i18n="register.username" data-i18n-attr="placeholder">
    </label>

    <label>旧密码
      <input id="cp_old" type="password" placeholder="旧密码" data-i18n="login.password" data-i18n-attr="placeholder">
    </label>

    <label>新密码
      <input id="cp_new" type="password" placeholder="新密码">
    </label>

    <label>确认新密码
      <input id="cp_new2" type="password" placeholder="再次输入新密码">
    </label>

    <div style="display:flex;gap:8px;margin-top:6px">
      <button id="btn_change" data-i18n="change.submit">提交修改</button>
      <a href="login.html" style="align-self:center;margin-left:8px;color:#666;text-decoration:none">返回登录</a>
    </div>

    <div id="cp_msg" class="muted" style="margin-top:10px"></div>
  </div>

  <script>
    const el = id => document.getElementById(id);
    el('btn_change').addEventListener('click', async ()=>{
      const user = el('cp_username').value.trim();
      const oldp = el('cp_old').value;
      const p1 = el('cp_new').value; const p2 = el('cp_new2').value;
      const msg = el('cp_msg'); msg.textContent = ''; msg.style.color='';
      if(!user||!oldp||!p1){ msg.textContent = '请完整填写用户名、旧密码和新密码'; return; }
      if(p1 !== p2){ msg.style.color='red'; msg.textContent='两次新密码不一致'; return; }
      if(p1.length < 6){ msg.style.color='red'; msg.textContent='新密码至少 6 位'; return; }
      el('btn_change').disabled = true; msg.textContent = '提交中...';
      try{
        const res = await fetch('auth.php',{
          method:'POST', headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ action: 'change_password', username: user, old_password: oldp, new_password: p1 })
        });
        const j = await res.json();
        if(j.status === 'ok'){
          msg.style.color='green'; msg.textContent = '密码已更新，请使用新密码登录';
          setTimeout(()=> location.href='login.html', 1400);
        } else {
          msg.style.color='red'; msg.textContent = '修改失败：' + (j.message || '未知错误');
        }
      }catch(e){ msg.style.color='red'; msg.textContent = '请求失败：' + e.message; }
      el('btn_change').disabled = false;
    });
  </script>
</body>
</html>

<script src="i18n.js"></script>
