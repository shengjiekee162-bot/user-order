<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>忘记密码 - 重置</title>
<style>
body { font-family: Arial; background: #f7f7f7; display:flex; justify-content:center; align-items:center; height:100vh; }
form { background:white; padding:30px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
input { display:block; width:300px; margin:10px 0; padding:8px; }
button { background:#f53d2d; color:white; border:none; padding:10px; width:100%; cursor:pointer; }
</style>
</head>
<body>

<form id="forgotForm">
  <h2>忘记密码</h2>
  <p>输入用户名以生成重置码（本地开发环境会直接显示重置码）。</p>
  <input type="text" id="username" placeholder="用户名" required>
  <button type="submit">生成重置码</button>
  <div id="result" style="margin-top:12px;color:#333;"></div>
  <a href="login.html">返回登录</a>
</form>

<script>
document.getElementById('forgotForm').onsubmit = async function(e){
  e.preventDefault();
  const username = document.getElementById('username').value.trim();
  if(!username) return alert('请输入用户名');
  const payload = { action: 'request_password_reset', username };
  try{
    const res = await fetch('auth.php', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(payload) });
    const msg = await res.json();
    if(msg.status === 'ok'){
      // 显示 token 并提供跳转链接到重置页面
      const token = msg.token;
      document.getElementById('result').innerHTML = `重置码：<b>${token}</b><br/><a href="reset_password.html?token=${token}">点击这里使用重置码重置密码</a>`;
    } else {
      document.getElementById('result').textContent = '错误：' + (msg.message || '生成失败');
    }
  } catch(err){
    document.getElementById('result').textContent = '网络错误：' + err.message;
  }
};
</script>

</body>
</html>
