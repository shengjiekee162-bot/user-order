<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>登录 - Shopee Clone</title>
<style>
  :root{
    --bg-1: #040612;
    --bg-2: #0b1230;
    --accent-a: #00d4ff;
    --accent-b: #b464ff;
    --card-bg: rgba(255,255,255,0.03);
    --muted: #98a3b8;
  }

  html,body{height:100%;}
  body { font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Arial; background: radial-gradient(circle at 10% 10%, #07102a, #040612 40%), linear-gradient(180deg,var(--bg-1),var(--bg-2)); display:flex; justify-content:center; align-items:center; padding:28px; color:#eaf6ff }

  form { background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.22)); padding:30px; border-radius:14px; box-shadow: 0 18px 50px rgba(2,6,20,0.7); border:1px solid rgba(180,100,255,0.08); width:360px }

  h2{ color: var(--accent-a); margin:0 0 10px }

  input { display:block; width:100%; margin:10px 0; padding:12px; border-radius:10px; background: rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.06); color:#eaf6ff }

  button { background: linear-gradient(90deg,var(--accent-a),var(--accent-b)); color:#031026; border:none; padding:10px; width:100%; cursor:pointer; border-radius:10px; font-weight:600 }

  a { display:block; margin-top:10px; text-align:center; color:var(--muted); text-decoration:none }

  .accent-link{ color: var(--accent-b); font-weight:700; text-decoration:none }
</style>
</head>
<body>

<form id="loginForm">
  <h2 data-i18n="login.title">登录账号</h2>
  <input type="text" id="username" placeholder="用户名" data-i18n="login.username" data-i18n-attr="placeholder" required>
  <input type="password" id="password" placeholder="密码" data-i18n="login.password" data-i18n-attr="placeholder" required>
  <button type="submit" data-i18n="login.submit">登录</button>
  <div style="display:flex; justify-content:space-between; align-items:center; margin-top:10px;">
    <a href="register.html">没有账号？去注册</a>
    <a href="forgot.html" class="accent-link" data-i18n="header.forgot">忘记密码？</a>
  </div>
</form>

<script>
document.getElementById("loginForm").onsubmit = async function(e){
  e.preventDefault();
  const data = {
    action: "login",
    username: username.value,
    password: password.value
  };
  try {
    const res = await fetch("auth.php", {
      method:"POST",
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(data)
    });
    const msg = await res.json();
    if(msg.status === "ok"){
      // 登录成功，标准化并保存用户信息到 localStorage（避免大小写/空格问题导致前端判断失效）
      if(msg.user && msg.user.role){
        msg.user.role = String(msg.user.role).toLowerCase().trim();
      } else if(msg.user){
        msg.user.role = 'buyer';
      }
      localStorage.setItem("user", JSON.stringify(msg.user));
      alert("登录成功！");
      // 根据角色跳转：seller -> seller.html, 其他 -> index.html
      const role = (msg.user && msg.user.role) || 'buyer';
      if(role === 'seller') {
        window.location.href = 'seller.html';
      } else {
        window.location.href = 'index.html';
      }
    } else {
      alert("登录失败：" + msg.message);
    }
  } catch(err){
    alert("网络错误：" + err.message);
  }
};
</script>
<script src="i18n.js"></script>

</body>
</html>
